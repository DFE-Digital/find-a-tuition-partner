name: Deploy to GOV.UK PaaS

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment for the deployment'
        required: true
        default: qa
        type: choice
        options:
          - qa
          - research
          - staging
          - production

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest

    env:
      CF_API: "https://api.london.cloud.service.gov.uk"
      CF_ORG: "dfe"
      CF_SPACE: ntp-${{ github.event.inputs.environment }}

    permissions:
      contents: read

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Use Node.js 16
        uses: actions/setup-node@v3
        with:
          node-version: 16

      - name: Terraform ( ${{inputs.environment}} )
        shell: bash
        run: |
            cd terraform/paas && pwd
            terraform init
        env:
          TF_VAR_username: ${{ secrets.CF_USERNAME }}
          TF_VAR_password: ${{ secrets.CF_PASSWORD }}

